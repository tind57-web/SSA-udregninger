<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SSA Beregner</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#0d9488" />
  <link rel="icon" href="icons/icon-192.png" />
  <style>
    :root{--primary:#0d9488;--accent:#10b981;--muted:#f1f5f9}
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0;background:#f8fafc;color:#111}
    .wrap{max-width:980px;margin:0 auto;padding:18px}
    header{background:var(--primary);color:#fff;padding:14px;border-radius:10px;text-align:center}
    .tabs{display:flex;flex-wrap:wrap;gap:8px;margin:14px 0;justify-content:center}
    .tabs button{padding:10px 14px;border-radius:10px;border:0;background:#e6eef0;cursor:pointer}
    .tabs button.active{background:#111827;color:#fff}
    .panel{background:#fff;padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(2,6,23,0.06);margin-bottom:14px}
    label{display:block;margin-top:8px;font-size:0.95rem}
    input,select,button{width:100%;padding:10px;border-radius:8px;border:1px solid #d1d5db;margin-top:6px;font-size:1rem;box-sizing:border-box}
    button.calc{background:var(--accent);color:white;border:0;cursor:pointer}
    .result{margin-top:10px;padding:10px;background:var(--muted);border-radius:8px;white-space:pre-line;font-weight:600}
    .log{max-height:300px;overflow:auto;padding:8px;background:#fbfeff;border-radius:8px;border:1px solid #e6eef6}
    .small{display:inline-block;padding:8px 10px;border-radius:8px;background:#0ea5e9;color:white;border:0;margin-top:8px;cursor:pointer}
    .bmi-bar{position:relative;height:14px;background:#e5e7eb;border-radius:999px;margin-top:10px}
    .bmi-range{position:absolute;top:0;height:100%}
    .bmi-blue{left:0;width:46.25%;background:#60a5fa}
    .bmi-green{left:46.25%;width:31.25%;background:#22c55e}
    .bmi-yellow{left:77.5%;width:12.5%;background:#f59e0b}
    .bmi-red{left:90%;width:10%;background:#ef4444}
    .bmi-pointer{position:absolute;top:-6px;width:2px;height:26px;background:#111;left:0}
    footer{color:#475569;text-align:center;margin-top:12px;font-size:0.9rem}
    @media(max-width:700px){ .tabs button{font-size:0.9rem;padding:8px} }
  </style>
</head>
<body>
  <div class="wrap">
    <header><h1>ü©∫ SSA Beregner</h1></header>

    <div class="tabs" role="tablist">
      <button onclick="show('tablet')" id="btn-tablet" class="active">üíä Tablet/Dosis</button>
      <button onclick="show('vaeske')" id="btn-vaeske">üíß V√¶skebalance</button>
      <button onclick="show('drop')" id="btn-drop">üíâ Dr√•ber/minut</button>
      <button onclick="show('bmi')" id="btn-bmi">‚öñÔ∏è BMI</button>
      <button onclick="show('procent')" id="btn-procent">üßÆ Procent</button>
      <button onclick="show('energi')" id="btn-energi">‚ö° Energi</button>
      <button onclick="show('log')" id="btn-log">üìú Log</button>
    </div>

    <!-- üíä Tablet/Dosis -->
    <section id="tablet" class="panel">
      <label>√ònsket dosis (mg)</label><input id="dose" type="number" inputmode="decimal"/>
      <label>Mg pr. tablet</label><input id="mg" type="number" inputmode="decimal"/>
      <label>Antal tabletter</label><input id="antal" type="number" inputmode="decimal"/>
      <label>Koncentration (mg/ml)</label><input id="mgml" type="number" inputmode="decimal"/>
      <label>Volumen (ml)</label><input id="vol" type="number" inputmode="decimal"/>
      <button class="calc" onclick="calcTablet()">Beregn</button>
      <div id="tabletRes" class="result" aria-live="polite"></div>
      <button class="small" onclick="saveCurrent('Tablet/Dosis', document.getElementById('tabletRes').innerText)">Gem</button>
    </section>

    <!-- üíß V√¶skebalance -->
    <section id="vaeske" class="panel" style="display:none">
      <label>V√¶ske ind (ml)</label><input id="ind" type="number"/>
      <label>V√¶ske ud (ml)</label><input id="ud" type="number"/>
      <button class="calc" onclick="calcVaeske()">Beregn</button>
      <div id="vaeskeRes" class="result"></div>
      <button class="small" onclick="saveCurrent('V√¶skebalance', document.getElementById('vaeskeRes').innerText)">Gem</button>
    </section>

    <!-- üíâ Dr√•ber/minut -->
    <section id="drop" class="panel" style="display:none">
      <label>V√¶skem√¶ngde (ml)</label><input id="dropMl" type="number"/>
      <label>Tid (timer)</label><input id="dropTid" type="number"/>
      <button class="calc" onclick="calcDrop()">Beregn</button>
      <div id="dropRes" class="result"></div>
      <button class="small" onclick="saveCurrent('Dr√•ber/minut', document.getElementById('dropRes').innerText)">Gem</button>
    </section>

    <!-- ‚öñÔ∏è BMI -->
    <section id="bmi" class="panel" style="display:none">
      <label>V√¶gt (kg)</label><input id="bmiVaegt" type="number"/>
      <label>H√∏jde (cm)</label><input id="bmiHojde" type="number"/>
      <button class="calc" onclick="calcBMI()">Beregn</button>
      <div id="bmiRes" class="result"></div>
      <div class="bmi-bar" aria-hidden="true">
        <div class="bmi-range bmi-blue"></div>
        <div class="bmi-range bmi-green"></div>
        <div class="bmi-range bmi-yellow"></div>
        <div class="bmi-range bmi-red"></div>
        <div id="bmiPointer" class="bmi-pointer"></div>
      </div>
      <button class="small" onclick="saveCurrent('BMI', document.getElementById('bmiRes').innerText)">Gem</button>
    </section>

    <!-- üßÆ Procent -->
    <section id="procent" class="panel" style="display:none">
      <label>Udgangsprocent (%)</label><input id="pctStart" type="number"/>
      <label>√ònsket procent (%)</label><input id="pctSlut" type="number"/>
      <label>Slutvolumen (ml)</label><input id="pctVol" type="number"/>
      <button class="calc" onclick="calcPct()">Beregn</button>
      <div id="pctRes" class="result"></div>
      <button class="small" onclick="saveCurrent('Procentregning', document.getElementById('pctRes').innerText)">Gem</button>
    </section>

    <!-- ‚ö° Energi -->
    <section id="energi" class="panel" style="display:none">
      <label>V√¶gt (kg)</label><input id="enVaegt" type="number"/>
      <label>Aktivitetsniveau</label>
      <select id="enAkt">
        <option value="1.2">Meget lav (sengeliggende) √ó1.2</option>
        <option value="1.4">Lav (stille arbejde) √ó1.4</option>
        <option value="1.6" selected>Moderat (normalt aktiv) √ó1.6</option>
        <option value="1.8">H√∏j (fysisk arbejde) √ó1.8</option>
        <option value="2.0">Meget h√∏j (atlet) √ó2.0</option>
      </select>
      <button class="calc" onclick="calcEnergi()">Beregn</button>
      <div id="enRes" class="result"></div>
      <button class="small" onclick="saveCurrent('Energi', document.getElementById('enRes').innerText)">Gem</button>
    </section>

    <!-- üìú Log -->
    <section id="log" class="panel" style="display:none">
      <div class="log" id="logList">Ingen gemte udregninger.</div>
      <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap">
        <button class="calc" onclick="exportLog()">Eksport√©r log (.txt)</button>
        <button class="calc" onclick="clearLog()">Ryd log</button>
      </div>
    </section>

    <footer>Gemte udregninger ligger i browserens localStorage.</footer>
  </div>

<script>
/* Tabs */
function show(id){
  document.querySelectorAll('section.panel').forEach(p=>p.style.display='none');
  document.getElementById(id).style.display='block';
  document.querySelectorAll('.tabs button').forEach(b=>b.classList.remove('active'));
  document.getElementById('btn-'+id).classList.add('active');
}

/* Log */
function getLog(){ return JSON.parse(localStorage.getItem('ssaLog')||'[]'); }
function setLog(arr){ localStorage.setItem('ssaLog', JSON.stringify(arr)); renderLog(); }
function saveCurrent(type, text){
  if(!text || text.trim()==='') return alert('Ingen resultat at gemme.');
  const logs = getLog();
  logs.unshift({time:new Date().toLocaleString(), type, text});
  setLog(logs);
  alert('Udregning gemt.');
}
function renderLog(){
  const logs = getLog();
  const el = document.getElementById('logList');
  if(!logs.length){ el.innerHTML = 'Ingen gemte udregninger.'; return; }
  el.innerHTML = logs.map(l => `[${l.time}] ${l.type}: ${l.text}`).join('<br>');
}
function clearLog(){ if(!confirm('Ryd loggen?')) return; localStorage.removeItem('ssaLog'); renderLog(); }
function exportLog(){
  const logs = getLog();
  if(!logs.length) return alert('Ingen gemte udregninger.');
  let content = 'SSA Beregner - Log\\n===================\\n\\n';
  logs.forEach(e=>{ content += '['+e.time+'] '+e.type+'\\n'+e.text+'\\n\\n'; });
  const blob = new Blob([content], {type:'text/plain'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'SSA_log.txt'; a.click(); URL.revokeObjectURL(url);
}

/* Beregninger */
function calcTablet(){
  const d = parseFloat(document.getElementById('dose').value);
  const m = parseFloat(document.getElementById('mg').value);
  const a = parseFloat(document.getElementById('antal').value);
  const mgml = parseFloat(document.getElementById('mgml').value);
  const ml = parseFloat(document.getElementById('vol').value);
  let out = [];
  if(d && m){ let t = d/m; t = Math.round(t*2)/2; out.push('Antal tabletter: '+t); }
  if(a && m){ out.push('Total dosis: '+(a*m).toFixed(1)+' mg'); }
  if(d && mgml){ out.push('M√¶ngde: '+(d/mgml).toFixed(2)+' ml'); }
  if(ml && mgml){ out.push('Dosis: '+(ml*mgml).toFixed(1)+' mg'); }
  document.getElementById('tabletRes').innerText = out.length? out.join('\\n') : 'Indtast v√¶rdier';
}
function calcVaeske(){
  const i = parseFloat(document.getElementById('ind').value)||0;
  const u = parseFloat(document.getElementById('ud').value)||0;
  document.getElementById('vaeskeRes').innerText = 'Balance: '+(i-u)+' ml';
}
function calcDrop(){
  const m = parseFloat(document.getElementById('dropMl').value);
  const t = parseFloat(document.getElementById('dropTid').value);
  if(!m||!t){ alert('Indtast ml og tid'); return; }
  const dr = ((m*20)/(t*60)).toFixed(1);
  document.getElementById('dropRes').innerText = dr+' dr√•ber/min';
}
function calcBMI(){
  const v = parseFloat(document.getElementById('bmiVaegt').value);
  const h = parseFloat(document.getElementById('bmiHojde').value)/100;
  if(!v||!h){ alert('Indtast v√¶gt og h√∏jde'); return; }
  const bmi = v/(h*h);
  let kat=''; if(bmi<18.5)kat='Underv√¶gt'; else if(bmi<25)kat='Normalv√¶gt'; else if(bmi<30)kat='Overv√¶gt'; else kat='Sv√¶r overv√¶gt';
  let txt='BMI: '+bmi.toFixed(1)+' ('+kat+')';
  const min=18.5*h*h, max=24.9*h*h;
  if(v<min) txt+='\\nDu skal tage p√• '+(min-v).toFixed(1)+' kg for normalv√¶gt.';
  else if(v>max) txt+='\\nDu skal tabe '+(v-max).toFixed(1)+' kg for normalv√¶gt.';
  document.getElementById('bmiRes').innerText = txt;
  // grafisk mark√∏r 0-40
  const bar = document.querySelector('.bmi-bar');
  const ptr = document.getElementById('bmiPointer');
  const pct = Math.max(0, Math.min(1, bmi/40));
  ptr.style.left = (pct*bar.clientWidth) + 'px';
}
function calcPct(){
  const s = parseFloat(document.getElementById('pctStart').value);
  const e = parseFloat(document.getElementById('pctSlut').value);
  const v = parseFloat(document.getElementById('pctVol').value);
  if(!s||!e||!v){ alert('Udfyld alle felter'); return; }
  const m1 = (e*v)/s; const vand = (v-m1).toFixed(1);
  document.getElementById('pctRes').innerText = 'Tils√¶t: '+vand+' ml vand';
}
function calcEnergi(){
  const v = parseFloat(document.getElementById('enVaegt').value);
  const f = parseFloat(document.getElementById('enAkt').value);
  if(!v){ alert('Indtast v√¶gt'); return; }
  const bmr = v * 100; // 100 kJ/kg
  const total = bmr * f;
  const kcal = total/4.184;
  document.getElementById('enRes').innerText = 
    'Basalstofskifte: '+bmr.toFixed(0)+' kJ/d√∏gn\\nTotal energibehov: '+total.toFixed(0)+' kJ/d√∏gn ('+kcal.toFixed(0)+' kcal)';
}

/* SW */
if('serviceWorker' in navigator){
  window.addEventListener('load', ()=>{
    navigator.serviceWorker.register('./service-worker.js').catch(()=>{});
  });
}

/* Init */
renderLog();
show('tablet');
</script>
</body>
</html>
